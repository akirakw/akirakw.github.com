<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>An Artisan's Build Act</title>
        <link>http://akirakw.github.com/</link>
        <description>とあるビルド職人の、チクチク作業した軌跡</description>
        <language>en-us</language>
        <pubDate>Thu, 13 Sep 2012 00:00:00 +0900</pubDate>
        
        <item>
            <link>http://akirakw.github.com/2012/09/13/customize_tinkerer.html</link>
            <guid>http://akirakw.github.com/2012/09/13/customize_tinkerer.html</guid>
            <title>Tinkererをカスタマイズする</title>
            <description><![CDATA[<div class="section" id="tinkerer">
<h1>Tinkererをカスタマイズする</h1>
<p>前回のポスト <a class="reference internal" href="http://akirakw.github.com/2012/09/13/../12/create_blog_with_tinkerer.html"><em>TinkererでSphinxなブログ環境を構築する</em></a> でとりあえずSphinxなブログ環境を構築しましたが、デフォルトだとちょっと寂しい感じなので、いろいろカスタマイズしてみます。</p>
<div class="section" id="id1">
<h2>コメント機能をつける</h2>
<p><a class="reference external" href="http://tinkerer.me/">Tinkerer</a> では内部ではコメント管理の機能を持っていないため、外部のコメント管理用サービスを利用してコメントを扱います。</p>
<p>Tinkererのドキュメントでは、 <a class="reference external" href="http://disqus.com/">Disqus</a> を利用してコメント機能をつける方法と、 <a class="reference external" href="http://developers.facebook.com/docs/reference/plugins/comments/">Facebook Comments</a> を利用した方法が紹介されています。</p>
<p>まず Disqus を試してみたのですが、コメントを投稿してから反映されるのがかなり遅かったり、コメントを削除してもカウンターのほうでユーザー名入りの履歴が残ってしまったりといろいろ微妙な感じでした。</p>
<p>Facebook Comments のほうは安定しているのですが、匿名ユーザからコメントを受け付けることが出来ません。でもまあこのブログではそれでもいいかな、ということでFacebook Comments を利用することにしました。</p>
<div class="section" id="id3">
<h3>Facebook Commentsを利用する</h3>
<p>Facebook Commentsを利用する <a class="footnote-reference" href="#id6" id="id4">[1]</a> には、まず <cite>conf.py</cite> を編集し、extentionの設定をデフォルトの Disqus から Facebook Comments のものに置き換えます。</p>
<p>デフォルトは以下のようになっています。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">52</span> <span class="c"># Add other Sphinx extensions here</span>
<span class="mi">53</span> <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tinkerer.ext.blog'</span><span class="p">,</span> <span class="s">'tinkerer.ext.disqus'</span><span class="p">]</span>
</pre></div>
</div>
<p>この <tt class="docutils literal"><span class="pre">tinkerer.ext.disqus</span></tt> を <tt class="docutils literal"><span class="pre">tinkerer.ext.fbcomments</span></tt> に置き換えます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">52</span> <span class="c"># Add other Sphinx extensions here</span>
<span class="mi">53</span> <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s">'tinkerer.ext.blog'</span><span class="p">,</span> <span class="s">'tinkerer.ext.fbcomments'</span><span class="p">]</span>
</pre></div>
</div>
<p>次にこのコメントを管理するための <tt class="docutils literal"><span class="pre">meta</span></tt> タグをページにしこむ必要があります。このため、Tinkererが提供するページのテンプレートを拡張します。</p>
<p>まず、テンプレートの拡張ファイルを配置するディレクトリ <tt class="docutils literal"><span class="pre">_template</span></tt> を作成し、そこに <tt class="docutils literal"><span class="pre">page.html</span></tt> を作成します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cd</span> <span class="o">&lt;...&gt;/</span><span class="n">myblog</span>
<span class="n">mkdir</span> <span class="n">_template</span>
<span class="n">vi</span> <span class="n">_template</span><span class="o">/</span><span class="n">page</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">page.html</span></tt> にFacebook コメント管理用の定義を追加しますが、これにはFacebookの ユーザID を使用する方法と、 アプリケーションID を利用する方法の2つがあります。ここでは後者のアプリケーションID を使う方法で進めます。FacebookのアプリケーションIDを事前に取得しておく必要があります <a class="footnote-reference" href="#id7" id="id5">[2]</a> 。</p>
<p>アプリケーションIDを使用する場合は、 <tt class="docutils literal"><span class="pre">page.html</span></tt> に以下の定義を追加します。</p>
<div class="highlight-html"><div class="highlight"><pre>{% extends &quot;!page.html&quot; %}

{%- block extrahead %}
    <span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;fb:app_id&quot;</span> <span class="na">content=</span><span class="s">&quot;$(YOUR_APP_ID)&quot;</span><span class="nt">/&gt;</span>
    {{ super() }}
{% endblock %}
</pre></div>
</div>
<p>上記の <tt class="docutils literal"><span class="pre">$(YOUR_APP_ID)</span></tt> の部分を自分のアプリケーションIDの値に置き換えます。</p>
<p>この状態でビルドしたコンテンツをホストにアップすると、Facebookのコメント機能が有効になります。</p>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[1]</a></td><td>さらに詳しい内容は公式ドキュメントの以下を参照してください: <a class="reference external" href="http://tinkerer.me/doc/additional_extensions.html#facebook-comments">http://tinkerer.me/doc/additional_extensions.html#facebook-comments</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[2]</a></td><td>FacebookのアプリケーションIDを取得する方法は検索するとたくさん出てきます。わかりやすいのはこちら: <a class="reference external" href="https://www.ocnk.net/faq/index.php?action=artikel&amp;cat=281579&amp;id=733&amp;artlang=ja">https://www.ocnk.net/faq/index.php?action=artikel&amp;cat=281579&amp;id=733&amp;artlang=ja</a></td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id8">
<h2>サイドバーを拡張する</h2>
<p>デフォルトだとサイドバーが寂しいので、いろいろ増やします。</p>
<div class="section" id="id9">
<h3>組み込みのサイドバー部品を追加する</h3>
<p>Tinkererから提供されているサイドバー部品のいくつかはデフォルトで無効になっているので、まずは設定でこれらを追加します <a class="footnote-reference" href="#id11" id="id10">[3]</a> 。これも <tt class="docutils literal"><span class="pre">conf.py</span></tt> の設定です。</p>
<p>以下では、 <tt class="docutils literal"><span class="pre">categories.html</span></tt> と <tt class="docutils literal"><span class="pre">tags.html</span></tt> を追加し、順番を入れ替えました。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">67</span> <span class="c"># Add templates to be rendered in sidebar here</span>
<span class="mi">68</span> <span class="n">html_sidebars</span> <span class="o">=</span> <span class="p">{</span>
<span class="mi">69</span>     <span class="s">&quot;**&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;recent.html&quot;</span><span class="p">,</span> <span class="s">&quot;categories.html&quot;</span><span class="p">,</span> <span class="s">&quot;tags.html&quot;</span><span class="p">,</span> <span class="s">&quot;searchbox.html&quot;</span><span class="p">]</span>
<span class="mi">70</span> <span class="p">}</span>
</pre></div>
</div>
<p>なお、このほかにも <tt class="docutils literal"><span class="pre">tags_cloud.html</span></tt> というタグクラウドを出すものも提供されているのですが、これを追加するとビルドに失敗してしまいました。時間があるときに調べるかも...。</p>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[3]</a></td><td>さらに詳しい内容は公式ドキュメントの以下を参照してください: <a class="reference external" href="http://tinkerer.me/doc/more_tinkering.html#sidebar">http://tinkerer.me/doc/more_tinkering.html#sidebar</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="id12">
<h3>自作のサイドバー部品を追加する</h3>
<p>自作のサイドバー部品の追加も(わかってしまえば)簡単に出来ます。</p>
<p>ここでは、Twitterの埋め込みタイムライン <a class="footnote-reference" href="#id15" id="id13">[4]</a> を追加してみます。</p>
<p>まず、テンプレートの拡張ファイルを配置するディレクトリ <tt class="docutils literal"><span class="pre">_template</span></tt> を作成し <a class="footnote-reference" href="#id16" id="id14">[5]</a> 、そこにサイドバー部品用のHTMLファイルを作成します。ここでは <tt class="docutils literal"><span class="pre">twitter.html</span></tt> を作成します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cd</span> <span class="o">&lt;...&gt;/</span><span class="n">myblog</span>
<span class="n">mkdir</span> <span class="n">_template</span>
<span class="n">vi</span> <span class="n">_template</span><span class="o">/</span><span class="n">twitter</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">twitter.html</span></tt> には <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">class=&quot;widget&quot;&gt;</span></tt> の中にHTMLやスクリプトの定義を追加します。</p>
<div class="highlight-html"><div class="highlight"><pre>{#-
    twitter.html
    ~~~~~~~~~~~~

    Show Twitter Widget to Sidebar.

-#}

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;widget&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Twitter<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;twitter-timeline&quot;</span> <span class="na">width=</span><span class="s">&quot;250&quot;</span> <span class="na">height=</span><span class="s">&quot;500&quot;</span> <span class="na">href=</span><span class="s">&quot;https://twitter.com/apirakun&quot;</span> <span class="na">data-widget-id=</span><span class="s">&quot;$(YOUR_WIDGET_ID)&quot;</span><span class="nt">&gt;</span>@$(YOUR_ID) からのツイート<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;script&gt;</span><span class="o">!</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">id</span><span class="p">){</span><span class="kd">var</span> <span class="nx">js</span><span class="p">,</span><span class="nx">fjs</span><span class="o">=</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">)){</span><span class="nx">js</span><span class="o">=</span><span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span><span class="nx">js</span><span class="p">.</span><span class="nx">id</span><span class="o">=</span><span class="nx">id</span><span class="p">;</span><span class="nx">js</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s2">&quot;//platform.twitter.com/widgets.js&quot;</span><span class="p">;</span><span class="nx">fjs</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">js</span><span class="p">,</span><span class="nx">fjs</span><span class="p">);}}(</span><span class="nb">document</span><span class="p">,</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="s2">&quot;twitter-wjs&quot;</span><span class="p">);</span><span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p>横幅の調整に苦労しました...。Twitterのドキュメントには親のdivの定義を参照してよろしくやってくれるようなことが書かれていますが、手元ではそうでもなかったので適当な値を絶対指定しています。</p>
<p>次に、 <tt class="docutils literal"><span class="pre">conf.py</span></tt> を編集して上記で作成したサイドバーのHTMLを使うよう設定を追加します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">67</span> <span class="c"># Add templates to be rendered in sidebar here</span>
<span class="mi">68</span> <span class="n">html_sidebars</span> <span class="o">=</span> <span class="p">{</span>
<span class="mi">69</span>     <span class="s">&quot;**&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;twitter.html&quot;</span><span class="p">,</span> <span class="s">&quot;recent.html&quot;</span><span class="p">,</span> <span class="s">&quot;categories.html&quot;</span><span class="p">,</span> <span class="s">&quot;tags.html&quot;</span><span class="p">,</span> <span class="s">&quot;searchbox.html&quot;</span><span class="p">]</span>
<span class="mi">70</span> <span class="p">}</span>
</pre></div>
</div>
<p>これでビルドすると、サイドバーに追加されます。</p>
<table class="docutils footnote" frame="void" id="id15" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id13">[4]</a></td><td><a class="reference external" href="https://dev.twitter.com/docs/embedded-timelines">https://dev.twitter.com/docs/embedded-timelines</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id16" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id14">[5]</a></td><td>Facebook Commentsを利用する の手順を実施済みの場合は <tt class="docutils literal"><span class="pre">_template</span></tt> は既に作ってあるはずです。</td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id17">
<h2>ページを拡張する</h2>
<p>ページ本体も少し拡張したいです。ここでは Twitter のツイートボタンを追加します。</p>
<p>まず、テンプレートの拡張ファイルを配置するディレクトリ <tt class="docutils literal"><span class="pre">_template</span></tt> を作成し、そこに <tt class="docutils literal"><span class="pre">page.html</span></tt> を作成します。このあたりはこれまでの手順をやっていれば出来ていると思うので、もしあったらスキップしてください。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cd</span> <span class="o">&lt;...&gt;/</span><span class="n">myblog</span>
<span class="n">mkdir</span> <span class="n">_template</span>
<span class="n">vi</span> <span class="n">_template</span><span class="o">/</span><span class="n">page</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">page.html</span></tt> に ツイートボタン用の定義 <a class="footnote-reference" href="#id19" id="id18">[6]</a> を追加します。</p>
<div class="highlight-html"><div class="highlight"><pre>{%- block body %}
    {{ timestamp(metadata.date, timestamp_format) }}
    {{ body }}
    <span class="nt">&lt;br/&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;https://twitter.com/share&quot;</span> <span class="na">class=</span><span class="s">&quot;twitter-share-button&quot;</span> <span class="na">data-size=</span><span class="s">&quot;large&quot;</span> <span class="na">data-count=</span><span class="s">&quot;none&quot;</span><span class="nt">&gt;</span>Tweet<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;script&gt;</span><span class="o">!</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">id</span><span class="p">){</span><span class="kd">var</span> <span class="nx">js</span><span class="p">,</span><span class="nx">fjs</span><span class="o">=</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">)){</span><span class="nx">js</span><span class="o">=</span><span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span><span class="nx">js</span><span class="p">.</span><span class="nx">id</span><span class="o">=</span><span class="nx">id</span><span class="p">;</span><span class="nx">js</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s2">&quot;//platform.twitter.com/widgets.js&quot;</span><span class="p">;</span><span class="nx">fjs</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">js</span><span class="p">,</span><span class="nx">fjs</span><span class="p">);}}(</span><span class="nb">document</span><span class="p">,</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="s2">&quot;twitter-wjs&quot;</span><span class="p">);</span><span class="nt">&lt;/script&gt;</span>
    {{ post_meta(metadata) }}
    {{ comments }}
{% endblock %}
</pre></div>
</div>
<p>ページ本体を拡張する場合は、 <tt class="docutils literal"><span class="pre">{%-</span> <span class="pre">block</span> <span class="pre">body</span> <span class="pre">%}</span></tt> 内に定義を追加します。で、実は最初はもっとシンプルに、以下のように親テンプレートの定義にアペンドする、という定義をやってみたのですが...</p>
<div class="highlight-html"><div class="highlight"><pre>{%- block body %}
    {{ super() }}
    追加する定義部分...
{% endblock %}
</pre></div>
</div>
<p>これだと、コメント機能が有効になっている場合にはコメント欄をクリックしないとツイートボタンが見られない、という状態になってしまいました。そこで少し微妙ですが、親の定義を完全に上書きし、本文の直後にツイートボタンがくるよう設定しました。</p>
<p>(追記)と、書いてみたのですが、どうもまだこのあたりの挙動が思ったとおりいっていない感じですね...。</p>
<table class="docutils footnote" frame="void" id="id19" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id18">[6]</a></td><td>ここから作れます: <a class="reference external" href="https://twitter.com/about/resources/buttons">https://twitter.com/about/resources/buttons</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="google-analytics">
<h2>Google Analyticsを設定する</h2>
<p>最後に、Google Analyticsを設定します <a class="footnote-reference" href="#id22" id="id20">[7]</a> 。</p>
<p>まず Google Analyticsのサイト <a class="footnote-reference" href="#id23" id="id21">[8]</a> にいき、アカウントを作成します。</p>
<p>アカウント作成後にJavaScriptのスクリプトが画面に表示されるので、スクリプト文字列をコピーしておきます。この時の注意点で、 <tt class="docutils literal"><span class="pre">&lt;script&gt;</span></tt> タグの部分に囲まれた文字列が出力されますが、タグ自身はコピーせず、タグの中身だけをコピーしてください。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">_gaq</span> <span class="o">=</span> <span class="nx">_gaq</span> <span class="o">||</span> <span class="p">[];</span>
<span class="nx">_gaq</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="s1">'_setAccount'</span><span class="p">,</span> <span class="s1">'UA-34761823-1'</span><span class="p">]);</span>
<span class="nx">_gaq</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="s1">'_trackPageview'</span><span class="p">]);</span>

<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">ga</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'script'</span><span class="p">);</span> <span class="nx">ga</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">'text/javascript'</span><span class="p">;</span> <span class="nx">ga</span><span class="p">.</span><span class="nx">async</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">ga</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'https:'</span> <span class="o">==</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">?</span> <span class="s1">'https://ssl'</span> <span class="o">:</span> <span class="s1">'http://www'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'.google-analytics.com/ga.js'</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'script'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span> <span class="nx">s</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">ga</span><span class="p">,</span> <span class="nx">s</span><span class="p">);</span>
<span class="p">})();</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">_static/google_analytics.js</span></tt> というファイルを作成して、これにコピーしたスクリプト文字列を貼り付けて保存します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cd</span> <span class="o">&lt;...&gt;/</span><span class="n">myblog</span>
<span class="n">mkdir</span> <span class="n">_static</span>
<span class="n">vi</span> <span class="n">_static</span><span class="o">/</span><span class="n">google_analytics</span><span class="o">.</span><span class="n">js</span>
</pre></div>
</div>
<p>次に今までと同様、 <tt class="docutils literal"><span class="pre">_template/page.html</span></tt> を編集します(なければ作ります)。</p>
<div class="highlight-html"><div class="highlight"><pre>{% extends &quot;!page.html&quot; %}

{% set script_files = script_files + [&quot;_static/google_analytics.js&quot;] %}
</pre></div>
</div>
<p>これまでの手順のどれかを実施済みであれば <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">extends</span> <span class="pre">&quot;!page.html&quot;</span> <span class="pre">%}</span></tt> はすでにあるはずなので、 <tt class="docutils literal"><span class="pre">{$</span> <span class="pre">set...</span></tt> の部分だけを追加します。</p>
<p>この状態でビルドしたコンテンツをホストにアップすると、Google Analyticsが有効になります。手元ではリアルタイム検索で数秒で情報が反映されていました。</p>
<p>動作していないと思ったら、JavaScriptがうまく設定できていないか疑ってみてください。コピペミスでJavaScriptエラーなどが出ているかもしれません（私はそれで少しはまりました）。</p>
<table class="docutils footnote" frame="void" id="id22" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id20">[7]</a></td><td>さらに詳しくは公式ドキュメントの以下を参照してください: <a class="reference external" href="http://tinkerer.me/doc/more_tinkering.html#enabling-google-analytics">http://tinkerer.me/doc/more_tinkering.html#enabling-google-analytics</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id23" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id21">[8]</a></td><td><a class="reference external" href="http://google.com/analytics">http://google.com/analytics</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="id24">
<h2>今後は...</h2>
<p>とりあえず基本的なカスタマイズ方法を通してみました。</p>
<p>あとはCSSもカスタマイズしたいなーと思っていますが、その辺りは結構疎いので、はたしてやるかどうか...。</p>
</div>
</div>]]></description>
            <category><![CDATA[ sphinx ]]></category>
             <pubDate>Thu, 13 Sep 2012 00:00:00 +0900</pubDate>
        </item>
    
        <item>
            <link>http://akirakw.github.com/2012/09/12/create_blog_with_tinkerer.html</link>
            <guid>http://akirakw.github.com/2012/09/12/create_blog_with_tinkerer.html</guid>
            <title>TinkererでSphinxなブログ環境を構築する</title>
            <description><![CDATA[<div class="section" id="tinkerersphinx">
<h1>TinkererでSphinxなブログ環境を構築する</h1>
<p><a class="reference external" href="http://tinkerer.me/">Tinkerer</a> でブログ環境を構築した一連の手順を書いておきます。</p>
<p>概ね <a class="reference external" href="http://tinkerer.me/pages/documentation.html">公式ドキュメント</a> の通りにやればOKでしたが、はまったりカスタマイズ方法に悩んだ部分もあったので。</p>
<p>使用したOSは Ubuntu 11.04 です。</p>
<div class="section" id="id2">
<h2>Tinkererとはなに？</h2>
<p>簡単に言うと、Sphinxをブログ作成、管理用に特化させたブログツールです。</p>
<p>Sphinxの機能はほぼそのまま使えるようなので、Sphinxに慣れている職人さんたちは、
これでブログを書くといろいろ便利そうなのは推して知るべしだと思います。</p>
</div>
<div class="section" id="id3">
<h2>Tinkererのインストール</h2>
<p>easy_install を使ってtinkererをインストールします。</p>
<div class="highlight-sh"><div class="highlight"><pre>sudo easy_install tinkerer
</pre></div>
</div>
<p>これを書いている時点では、version 0.4.1b がインストールされました。</p>
<div class="section" id="id4">
<h3>日本語環境用のパッチを当てる</h3>
<p>手元のUbuntuは日本語環境ですが、どうやら 0.4.1b 時点では日本語環境でTinkererを使うと
Unicode errorが発生していまい、ビルドが出来ないようです。以下のissueが上がっています。</p>
<p><a class="reference external" href="https://bitbucket.org/vladris/tinkerer/issue/47/a-unicode-error-occurred-when-lc_all-is">https://bitbucket.org/vladris/tinkerer/issue/47/a-unicode-error-occurred-when-lc_all-is</a></p>
<p>上記ページに貼ってあるパッチを適用すると、この問題が解消されました。
手元の環境では <tt class="docutils literal"><span class="pre">/usr/local/lib/python2.7/dist-packages/Tinkerer-0.4.1b-py2.7.egg/tinkerer/cmdline.py</span></tt> を編集し、
パッチの内容を適用( <tt class="docutils literal"><span class="pre">import</span> <span class="pre">locale</span></tt> と <tt class="docutils literal"><span class="pre">locale.setlocale(...</span></tt> の行を削除) しました。</p>
</div>
</div>
<div class="section" id="id5">
<h2>セットアップ</h2>
<p>まず <tt class="docutils literal"><span class="pre">tinkerer</span></tt> コマンドを使ってブログ作業用のディレクトリを作成します。</p>
<div class="highlight-sh"><div class="highlight"><pre>mkdir myblog
<span class="nb">cd </span>myblog
tinker --setup
</pre></div>
</div>
<p>カレントディレクトリにいろいろファイルが作成されます。このうち <tt class="docutils literal"><span class="pre">conf.py</span></tt> を編集してブログタイトルやAuthorなどの初期設定を行います。</p>
<div class="highlight-python"><div class="highlight"><pre> <span class="mi">6</span> <span class="c"># **************************************************************</span>
 <span class="mi">7</span> <span class="c"># TODO: Edit the lines below</span>
 <span class="mi">8</span> <span class="c"># **************************************************************</span>
 <span class="mi">9</span>
<span class="mi">10</span> <span class="c"># Change this to the name of your blog</span>
<span class="mi">11</span> <span class="n">project</span> <span class="o">=</span> <span class="s">'An Artisan</span><span class="se">\'</span><span class="s">s Build Act'</span>
<span class="mi">12</span>
<span class="mi">13</span> <span class="c"># Change this to the tagline of your blog</span>
<span class="mi">14</span> <span class="n">tagline</span> <span class="o">=</span> <span class="s">u'とあるビルド職人の、チクチク作業した軌跡'</span>
<span class="mi">15</span>
<span class="mi">16</span> <span class="c"># Change this to your name</span>
<span class="mi">17</span> <span class="n">author</span> <span class="o">=</span> <span class="s">'apirakun'</span>
<span class="mi">18</span>
<span class="mi">19</span> <span class="c"># Change this to your copyright string</span>
<span class="mi">20</span> <span class="n">copyright</span> <span class="o">=</span> <span class="s">'2012, '</span> <span class="o">+</span> <span class="n">author</span>
<span class="mi">21</span>
<span class="mi">22</span> <span class="c"># Change this to your blog root URL (required for RSS feed)</span>
<span class="mi">23</span> <span class="n">website</span> <span class="o">=</span> <span class="s">'http://akirakw.github.com'</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h2>記事を作る</h2>
<p>記事を作成するには、 <tt class="docutils literal"><span class="pre">tinker</span> <span class="pre">-p</span> <span class="pre">'&lt;ページ名&gt;'</span></tt> です。</p>
<div class="highlight-sh"><div class="highlight"><pre>tinker -p <span class="s1">'hoge'</span>
New post created as <span class="s1">'&lt;...&gt;/myblog/2012/09/12/hoge.rst'</span>
</pre></div>
</div>
<p>生成されたファイル名が表示されるので、このファイルをを編集します。</p>
<div class="highlight-sh"><div class="highlight"><pre>vi &lt;...&gt;/myblog/2012/09/12/hoge.rst
</pre></div>
</div>
<p>編集が終わったら、 <tt class="docutils literal"><span class="pre">tinker</span> <span class="pre">-b</span></tt> でビルドします。 Sphinxの <tt class="docutils literal"><span class="pre">make</span> <span class="pre">clean</span> <span class="pre">html</span></tt> に相当します。</p>
<div class="highlight-sh"><div class="highlight"><pre>tinker -b
</pre></div>
</div>
<p>基本はこんな感じですが、この他にもビルド対象とならないドラフトファイルを作成したり、ドラフトと本記事を相互に入れたり戻したり、通常のSphinxのような、日付に紐づかない静的なページを作ったりすることが出来ます。私はこのあたりの機能が気に入っています。</p>
<p>詳しくは公式ドキュメントのこちら <a class="footnote-reference" href="#id8" id="id7">[1]</a> を参照。</p>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[1]</a></td><td><a class="reference external" href="http://tinkerer.me/doc/tinkering.html">http://tinkerer.me/doc/tinkering.html</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="github-pages">
<h2>GitHub Pagesに公開する</h2>
<p>作成したページ群をホストします。公式ドキュメントでは BitBucket にホストする方法が紹介されていますが、ここでは GitHub Pages に公開します。</p>
<p>GitHub Pages にホストする場合、アカウントに紐づくページとして公開する方法と、プロジェクトに紐づくページとして公開する方法があります。今回は個人ブログということで、前者のアカウントに紐づくページとして公開します。</p>
<p>アカウントに紐づくページとして公開する場合、一例として以下のような手順を踏みます。</p>
<ol class="arabic simple">
<li>GitHubで <tt class="docutils literal"><span class="pre">&lt;アカウント名&gt;.github.com</span></tt> というリポジトリを作成する。</li>
<li>作成したリポジトリを <tt class="docutils literal"><span class="pre">git</span> <span class="pre">clone</span></tt> して、直下に <tt class="docutils literal"><span class="pre">.nojekyll</span></tt> ファイルを作成する。</li>
<li>Tinkererのビルドで生成した <tt class="docutils literal"><span class="pre">myblog/blog/html</span></tt> ディレクトリ以下のファイル郡を <tt class="docutils literal"><span class="pre">master</span></tt> ブランチに <tt class="docutils literal"><span class="pre">push</span></tt> する</li>
</ol>
<ol class="arabic simple" start="2">
<li>の手順が少し注意すべき点で、GitHub Pagesでは Jekyll というコンテンツ管理のシステムがデフォルトで有効になるようで、この Jekyll  がアンダースコアを含むディレクトリをうまく処理出来ないため、Sphinxがデフォルトで利用する <tt class="docutils literal"><span class="pre">_static</span></tt> や <tt class="docutils literal"><span class="pre">_template</span></tt> などのディレクトリをうまく扱えないようです。この Jekyll を無効にするために、 <tt class="docutils literal"><span class="pre">.nojekyll</span></tt> を配置する必要があります。</li>
</ol>
<p>以下、2.と3.の手順例です。</p>
<div class="highlight-sh"><div class="highlight"><pre>git clone git@github.com:akirakw/akirakw.github.com.git
<span class="nb">cd </span>akirakw.github.com
touch .nojekyll
rsync -av &lt;...&gt;/myblog/blog/html/ .
git add .
git commit -m <span class="s2">&quot;First commit of blog contents.&quot;</span>
git push origin master
</pre></div>
</div>
<p>これで完了です。最初だけはGitHub Pageの公開反映に数分かかるようです。数分後に <tt class="docutils literal"><span class="pre">http://&lt;アカウント名&gt;.github.com</span></tt> にアクセスすると、ブログページが表示できると思います。</p>
<p>とりあえず今回はブログ公開出来たところまで。
次回はTinkererのカスタマイズ編です。</p>
</div>
</div>]]></description>
            <category><![CDATA[ sphinx ]]></category>
             <pubDate>Wed, 12 Sep 2012 00:00:00 +0900</pubDate>
        </item>
    
        <item>
            <link>http://akirakw.github.com/2012/09/12/remodel.html</link>
            <guid>http://akirakw.github.com/2012/09/12/remodel.html</guid>
            <title>REMODEL</title>
            <description><![CDATA[<div class="section" id="remodel">
<h1>REMODEL</h1>
<p>夏休みということもあり、個人ブログを
<a class="reference external" href="http://tinkerer.me/">Tinkerer</a> を使って改築してみました <a class="footnote-reference" href="#id2" id="id1">[1]</a> 。</p>
<p>Sphinxで日々ガシガシドキュメントを書いているので、
これで快適ブログライフがおくれるかも、と淡い期待をよせています。</p>
<p>ビルド職人的な内容を中心に、技術ネタなどを書くつもりですが、はたして...。</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>はてなからGitHub Pagesに引越ししたので、改築というより建て替えですが...</td></tr>
</tbody>
</table>
</div>]]></description>
            <category><![CDATA[ misc ]]></category>
             <pubDate>Wed, 12 Sep 2012 00:00:00 +0900</pubDate>
        </item>
    
    </channel>
</rss>